<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DES Cloud Quest - Victory Celebration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientFlow 8s ease infinite;
            color: white;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }
        
        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
        }
        
        /* Floating elements */
        .floating-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }
        
        .floating-element {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float-around 15s linear infinite;
        }
        
        .floating-element:nth-child(odd) {
            animation-direction: reverse;
            background: rgba(255, 255, 255, 0.05);
        }
        
        @keyframes float-around {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        .container {
            display: grid;
            grid-template-rows: auto 1fr auto;
            height: 100vh;
            padding: 25px;
            position: relative;
            z-index: 1;
            gap: 25px;
        }
        
        /* Header Section */
        .victory-header {
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 30px;
            padding: 40px;
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .victory-title {
            font-size: 4.5em;
            font-weight: 900;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbow-text 3s ease-in-out infinite;
            margin-bottom: 15px;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }
        
        .victory-subtitle {
            font-size: 1.8em;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .tournament-info {
            font-size: 1.3em;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }
        
        @keyframes rainbow-text {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        /* Main Content */
        .winners-showcase {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            height: 100%;
        }
        
        .winner-section {
            background: rgba(0, 0, 0, 0.15);
            border-radius: 30px;
            padding: 35px;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.15);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .winner-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            opacity: 0;
            animation: section-glow 4s ease-in-out infinite;
        }
        
        @keyframes section-glow {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 35px;
            position: relative;
            z-index: 1;
        }
        
        .section-icon {
            font-size: 3em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .section-title {
            font-size: 2.8em;
            font-weight: 800;
            background: linear-gradient(45deg, #ff9a9e, #fecfef, #fecfef, #ff9a9e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .section-subtitle {
            font-size: 1.3em;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
        }
        
        /* Team Victory */
        .team-victory {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .champion-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .team-crown {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 3.5em;
            color: white;
            text-shadow: 3px 3px 10px rgba(0,0,0,0.8);
            border: 5px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.3);
            animation: crown-pulse 3s ease-in-out infinite;
            position: relative;
        }
        
        .team-crown::before {
            content: '👑';
            position: absolute;
            top: -20px;
            right: -10px;
            font-size: 0.6em;
            animation: crown-bounce 2s ease-in-out infinite;
        }
        
        @keyframes crown-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 50px rgba(255, 255, 255, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 70px rgba(255, 255, 255, 0.5); }
        }
        
        @keyframes crown-bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .team-details h2 {
            font-size: 4em;
            font-weight: 900;
            color: #ffffff;
            text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 15px;
        }
        
        .team-final-score {
            font-size: 3em;
            font-weight: 800;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        /* Individual Heroes */
        .individual-heroes {
            position: relative;
            z-index: 1;
        }
        
        .heroes-podium {
            display: flex;
            flex-direction: column;
            gap: 25px;
            height: 100%;
        }
        
        .hero-rank {
            display: flex;
            align-items: center;
            padding: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .hero-rank:nth-child(1) {
            flex: 1.3;
            border-color: rgba(255, 107, 107, 0.5);
            background: rgba(255, 107, 107, 0.1);
        }
        
        .hero-rank:nth-child(2) {
            flex: 1.2;
            border-color: rgba(78, 205, 196, 0.5);
            background: rgba(78, 205, 196, 0.1);
        }
        
        .hero-rank:nth-child(3) {
            flex: 1.1;
            border-color: rgba(69, 183, 209, 0.5);
            background: rgba(69, 183, 209, 0.1);
        }
        
        .hero-rank::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.1), transparent);
            opacity: 0;
            animation: hero-shine 3s ease-in-out infinite;
            animation-delay: calc(var(--delay) * 0.8s);
        }
        
        .hero-rank:nth-child(1) { --delay: 0; }
        .hero-rank:nth-child(2) { --delay: 1; }
        .hero-rank:nth-child(3) { --delay: 2; }
        
        @keyframes hero-shine {
            0%, 100% { opacity: 0; transform: translateX(-100%); }
            50% { opacity: 1; transform: translateX(100%); }
        }
        
        .rank-badge {
            font-size: 2.5em;
            font-weight: 900;
            min-width: 50px;
            text-align: center;
            margin-right: 25px;
            flex-shrink: 0;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.5);
        }
        
        .rank-badge.first { 
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .rank-badge.second { 
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .rank-badge.third { 
            background: linear-gradient(45deg, #45b7d1, #96c93d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin-right: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.8em;
            color: white;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
            border: 3px solid rgba(255, 255, 255, 0.4);
            flex-shrink: 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .hero-info {
            flex: 1;
            min-width: 0;
        }
        
        .hero-name {
            font-size: 2em;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.5);
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .hero-team {
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 600;
        }
        
        .hero-score {
            font-size: 2.2em;
            font-weight: 900;
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.5);
            text-align: right;
            flex-shrink: 0;
        }
        
        /* Footer */
        .victory-footer {
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.15);
        }
        
        .footer-celebration {
            font-size: 1.5em;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 12px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .final-timestamp {
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }
        
        /* Responsive */
        @media (max-height: 800px) {
            .victory-title { font-size: 3.5em; }
            .section-title { font-size: 2.2em; }
            .team-details h2 { font-size: 3em; }
            .team-final-score { font-size: 2.2em; }
            .hero-name { font-size: 1.6em; }
            .hero-score { font-size: 1.8em; }
        }
    </style>
</head>
<body>
    <!-- Floating background -->
    <div class="floating-bg" id="floatingBg"></div>

    <div class="container">
        <!-- Header -->
        <div class="victory-header">
            <h1 class="victory-title">VICTORY ACHIEVED!</h1>
            <div class="victory-subtitle">Battle for Cloud Championship</div>
            <div class="tournament-info">Final standings revealed: <span id="victoryTime">Loading...</span></div>
        </div>

        <!-- Main Winners Section -->
        <div class="winners-showcase">
            <!-- Team Victory -->
            <div class="winner-section">
                <div class="section-header">
                    <div class="section-icon">🏆</div>
                    <div class="section-title">TEAM VICTORY</div>
                    <div class="section-subtitle">Ultimate Champions</div>
                </div>
                
                <div class="team-victory">
                    <div class="champion-team">
                        <div class="team-crown" id="teamCrown">1</div>
                        <div class="team-details">
                            <h2 id="championTeamName">Loading...</h2>
                            <div class="team-final-score" id="championTeamScore">000</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Individual Heroes -->
            <div class="winner-section">
                <div class="section-header">
                    <div class="section-icon">⭐</div>
                    <div class="section-title">TOP HEROES</div>
                    <div class="section-subtitle">Elite Performers</div>
                </div>
                
                <div class="individual-heroes">
                    <div class="heroes-podium" id="heroesPodium">
                        <div class="hero-rank">
                            <div class="rank-badge first">1st</div>
                            <div class="hero-avatar" id="hero1Avatar">1</div>
                            <div class="hero-info">
                                <div class="hero-name" id="hero1Name">Loading...</div>
                                <div class="hero-team" id="hero1Team">Team</div>
                            </div>
                            <div class="hero-score" id="hero1Score">000</div>
                        </div>
                        
                        <div class="hero-rank">
                            <div class="rank-badge second">2nd</div>
                            <div class="hero-avatar" id="hero2Avatar">2</div>
                            <div class="hero-info">
                                <div class="hero-name" id="hero2Name">Loading...</div>
                                <div class="hero-team" id="hero2Team">Team</div>
                            </div>
                            <div class="hero-score" id="hero2Score">000</div>
                        </div>
                        
                        <div class="hero-rank">
                            <div class="rank-badge third">3rd</div>
                            <div class="hero-avatar" id="hero3Avatar">3</div>
                            <div class="hero-info">
                                <div class="hero-name" id="hero3Name">Loading...</div>
                                <div class="hero-team" id="hero3Team">Team</div>
                            </div>
                            <div class="hero-score" id="hero3Score">000</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="victory-footer">
            <div class="footer-celebration">Exceptional cloud mastery demonstrated by all competitors!</div>
            <div class="final-timestamp">Competition concluded: <span id="conclusionTime">Loading...</span></div>
        </div>
    </div>

    <script>
        // Convert RGB decimal values to hex color
        function rgbToHex(r, g, b) {
            const toHex = (val) => {
                const hex = Math.round(val * 255).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            };
            return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
        }
        
        // Ensure distinct colors for teams
        function getDistinctTeamColor(teamName, originalColor) {
            const distinctColors = {
                'Team 1': '#3498db',
                'Team 2': '#e74c3c',
                'Team 3': '#f39c12',
                'Team 4': '#9b59b6',
                'Team 5': '#2ecc71',
                'Team 6': '#e67e22',
                'Team 7': '#1abc9c',
                'Team 8': '#34495e'
            };
            return distinctColors[teamName] || originalColor;
        }
        
        // Create team lookup
        function createTeamLookup(teams) {
            const lookup = {};
            teams.forEach(team => {
                const originalColor = rgbToHex(team.flag.color_bg.r, team.flag.color_bg.g, team.flag.color_bg.b);
                const distinctColor = getDistinctTeamColor(team.name, originalColor);
                
                lookup[team.id] = {
                    name: team.name,
                    color: distinctColor
                };
            });
            return lookup;
        }
        
        // Load victory time from time.txt
        async function loadVictoryTime() {
            try {
                const response = await fetch('./time.txt?' + Date.now());
                if (response.ok) {
                    const victoryTime = await response.text();
                    return victoryTime.trim();
                } else {
                    return new Date().toLocaleString();
                }
            } catch (error) {
                return new Date().toLocaleString();
            }
        }
        
        // Display champion team
        function displayChampionTeam(data) {
            const teamLookup = createTeamLookup(data.group.teams);
            
            if (data.teams && data.teams.length > 0) {
                const championTeam = data.teams[0];
                const teamInfo = teamLookup[championTeam.team_id];
                
                document.getElementById('championTeamName').textContent = teamInfo?.name || 'Unknown Team';
                document.getElementById('championTeamScore').textContent = championTeam.reputation_points;
                
                // Set team color for crown
                const crown = document.getElementById('teamCrown');
                crown.style.backgroundColor = teamInfo?.color || '#667eea';
                crown.textContent = teamInfo?.name?.charAt(teamInfo.name.length - 1) || '1';
            }
        }
        
        // Display top 3 heroes
        function displayTopHeroes(data) {
            const teamLookup = createTeamLookup(data.group.teams);
            
            if (data.players && data.players.length >= 3) {
                for (let i = 0; i < 3; i++) {
                    const hero = data.players[i];
                    const teamInfo = teamLookup[hero.team_id];
                    
                    document.getElementById(`hero${i + 1}Name`).textContent = hero.avatar_name;
                    document.getElementById(`hero${i + 1}Team`).textContent = teamInfo?.name || 'No Team';
                    document.getElementById(`hero${i + 1}Score`).textContent = hero.reputation_points;
                    
                    // Set avatar color
                    const avatar = document.getElementById(`hero${i + 1}Avatar`);
                    avatar.style.backgroundColor = teamInfo?.color || '#667eea';
                    avatar.textContent = (i + 1).toString();
                }
            }
        }
        
        // Load and display victory data
        async function loadVictoryData() {
            try {
                const response = await fetch('./leaderboard-data.json?' + Date.now());
                
                if (response.ok) {
                    const data = await response.json();
                    
                    displayChampionTeam(data);
                    displayTopHeroes(data);
                    
                    console.log('Victory data loaded successfully');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('Error loading victory data:', error);
                
                // Show error state
                document.getElementById('championTeamName').textContent = 'Error loading data';
                document.getElementById('hero1Name').textContent = 'Error loading data';
                document.getElementById('hero2Name').textContent = 'Error loading data';
                document.getElementById('hero3Name').textContent = 'Error loading data';
            }
        }
        
        // Create floating elements
        function createFloatingElements() {
            const floatingBg = document.getElementById('floatingBg');
            
            for (let i = 0; i < 20; i++) {
                const element = document.createElement('div');
                element.className = 'floating-element';
                element.style.left = Math.random() * 100 + '%';
                element.style.width = element.style.height = (Math.random() * 100 + 50) + 'px';
                element.style.animationDelay = Math.random() * 15 + 's';
                element.style.animationDuration = (Math.random() * 10 + 10) + 's';
                floatingBg.appendChild(element);
            }
        }
        
        // Initialize victory celebration
        async function initializeVictory() {
            console.log('Initializing Victory Celebration...');
            
            // Load victory time
            const victoryTime = await loadVictoryTime();
            document.getElementById('victoryTime').textContent = victoryTime;
            document.getElementById('conclusionTime').textContent = victoryTime;
            
            // Load victory data
            await loadVictoryData();
            
            // Create floating elements
            createFloatingElements();
            
            console.log('Victory Celebration initialized!');
        }
        
        // Start the victory celebration
        document.addEventListener('DOMContentLoaded', initializeVictory);
    </script>
</body>
</html>
